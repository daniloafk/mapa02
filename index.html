<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>DeliveryTrack - Mapa</title>

    <!-- Mapbox GL JS -->
    <script src="https://unpkg.com/mapbox-gl@3.4.0/dist/mapbox-gl.js"></script>
    <link href="https://unpkg.com/mapbox-gl@3.4.0/dist/mapbox-gl.css" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            overflow: hidden;
        }

        #map {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Mapbox API Key
        mapboxgl.accessToken = 'pk.eyJ1IjoiZGFuaWxvYWZrIiwiYSI6ImNtajdra3l0aTA1MXUzZXB2bzByZjVjMXUifQ.RyPdNBII88Qk9xE3j8Rijw';

        // Map styles
        const isDark = document.documentElement.classList.contains('dark');

        // Initialize map
        const map = new mapboxgl.Map({
            container: 'map',
            style: isDark ? 'mapbox://styles/mapbox/dark-v11' : 'mapbox://styles/mapbox/streets-v12',
            center: [-46.6333, -23.5505], // SÃ£o Paulo default
            zoom: 12
        });

        // Add default Mapbox controls
        map.addControl(new mapboxgl.NavigationControl(), 'top-right');
        map.addControl(new mapboxgl.GeolocateControl({
            positionOptions: { enableHighAccuracy: true },
            trackUserLocation: true,
            showUserHeading: true
        }), 'top-right');
        map.addControl(new mapboxgl.ScaleControl(), 'bottom-left');

        // Try to get user location
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    map.setCenter([position.coords.longitude, position.coords.latitude]);
                },
                () => {
                    console.log('Geolocation not available, using default location');
                },
                { timeout: 5000 }
            );
        }
    </script>
</body>
</html>
